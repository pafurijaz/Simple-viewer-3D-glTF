// ==================== GLOBAL STATE ====================
let scene, camera, renderer, controls;
let currentModel = null;
let isOrthographic = false;
let modelInfo = {
    name: '',
    vertices: 0,
    faces: 0,
    fileSize: 0
};

// Updated translation state
let currentLanguage = localStorage.getItem('viewerLang') || 'en';
let translations = {};
let translationsLoaded = false;
let viewStates = {
    front: false,
    top: false,
    side: false
};

// ==================== TRANSLATION LOADER ====================
async function loadTranslations() {
    try {
        const response = await fetch('translations.json');
        if (!response.ok) throw new Error('Failed to load translations');
        translations = await response.json();
        translationsLoaded = true;
        console.log('Translations loaded successfully');
        updateLanguage(); // <-- ensure UI updates after loading
    } catch (error) {
        console.error('Error loading translations:', error);
        // Fallback to embedded translations if file not found
        translations = {
            en: {/* fallback translations as before */},
            it: {/* ... */},
            // ... other languages
        };
        translationsLoaded = true;
        updateLanguage();
    }
}

// ==================== LOCALIZATION ====================
function updateLanguage() {
    if (!translationsLoaded) return; // Don't update UI before translations are loaded!
    const lang = translations[currentLanguage] || translations.en;
    // ... rest unchanged ...
}

// ==================== APPLICATION INITIALIZATION ====================
async function init() {
    await loadTranslations();
    // ... rest unchanged ...
}

// ==================== EVENT LISTENERS ====================
function setupEventListeners() {
    // Language selector
    document.getElementById('languageSelector').addEventListener('change', (e) => {
        currentLanguage = e.target.value;
        localStorage.setItem('viewerLang', currentLanguage);
        updateLanguage();
    });
    // ... rest unchanged ...
}